{% load custom %}
{% define all_posts.paginator.num_pages as n_pages %}
{% define all_posts.number as curr_page %}
{% if n_pages > 1 %}
  <div class="d-flex justify-content-center">
    <hr class="col-3 col-md-2 mb-4">
  </div>
  <div class="d-flex justify-content-center">
    <nav aria-label="Page navigation">
      <ul class="pagination">
        {% comment %} Кнопка "Влево" {% endcomment %}
        {% if curr_page == 1 %}
          <li class="page-item">
            <span class="page-link disabled">‹</span>
          </li>
        {% else %}
          <li class="page-item">
            <a class="page-link" role="button" tabindex="0" href="{{ full_path }}?p={{ all_posts.previous_page_number }}{% if search %}&s={{ search }}{% endif %}">
              <span aria-hidden="true">‹</span>
              <span class="visually-hidden">Previous</span>
            </a>
          </li>
        {% endif %}
        {% for page in all_posts.paginator.page_range %}
          {% comment %} Первая и последняя страницы всегда отображаются {% endcomment %}
          {% if page == 1 or page == n_pages %}
            <li class="page-item {% if page == curr_page %} active{% endif %}">
              <a class="page-link" href="{{ full_path }}?p={{ page }}{% if search %}&s={{ search }}{% endif %}">{{ page }}</a>
            </li>
            {% comment %} Вторая страница - многоточие или кнопки {% endcomment %}
          {% elif page == 2 %}
            {% if n_pages > 7 and curr_page >= 5 %}
              <li class="page-item">
                <span class="page-link">…</span>
              </li>
            {% else %}
              <li class="page-item {% if page == curr_page %} active{% endif %}">
                <a class="page-link" href="{{ full_path }}?p={{ page }}{% if search %}&s={{ search }}{% endif %}">{{ page }}</a>
              </li>
            {% endif %}
            {% comment %} Предпоследняя страница - многоточие или кнопки {% endcomment %}
          {% elif page == n_pages|sub:1 %}
            {% if n_pages > 7 and curr_page <= n_pages|sub:4 %}
              <li class="page-item">
                <span class="page-link">…</span>
              </li>
            {% else %}
              <li class="page-item {% if page == curr_page %} active{% endif %}">
                <a class="page-link" href="{{ full_path }}?p={{ page }}{% if search %}&s={{ search }}{% endif %}">{{ page }}</a>
              </li>
            {% endif %}
            {% comment %} Текущая страница и две ближайшие {% endcomment %}
          {% elif n_pages > 7 %}
            {% if curr_page <= 3 and page <= 5 %}
              <li class="page-item {% if page == curr_page %} active{% endif %}">
                <a class="page-link" href="{{ full_path }}?p={{ page }}{% if search %}&s={{ search }}{% endif %}">{{ page }}</a>
              </li>
            {% elif curr_page >= n_pages|sub:2 and page >= n_pages|sub:4 %}
              <li class="page-item {% if page == curr_page %} active{% endif %}">
                <a class="page-link" href="{{ full_path }}?p={{ page }}{% if search %}&s={{ search }}{% endif %}">{{ page }}</a>
              </li>
            {% elif curr_page|sub:page|absolute < 2 %}
              <li class="page-item {% if page == curr_page %} active{% endif %}">
                <a class="page-link" href="{{ full_path }}?p={{ page }}{% if search %}&s={{ search }}{% endif %}">{{ page }}</a>
              </li>
            {% endif %}
          {% else %}
            <li class="page-item {% if page == curr_page %} active{% endif %}">
              <a class="page-link" href="{{ full_path }}?p={{ page }}{% if search %}&s={{ search }}{% endif %}">{{ page }}</a>
            </li>
          {% endif %}
        {% endfor %}
        {% comment %} Кнопка "Вперед" {% endcomment %}
        {% if curr_page == n_pages %}
          <li class="page-item">
            <span class="page-link">›</span>
          </li>
        {% else %}
          <li class="page-item">
            <a class="page-link" role="button" tabindex="0" href="{{ full_path }}?p={{ all_posts.next_page_number }}{% if search %}&s={{ search }}{% endif %}">
              <span aria-hidden="true">›</span>
              <span class="visually-hidden">Next</span>
            </a>
          </li>
        {% endif %}
      </ul>
    </nav>
  </div>
{% endif %}
